import com.sun.net.httpserver.HttpExchange;
import com.sun.net.httpserver.HttpHandler;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.json.JSONException;
import org.json.JSONObject;

import java.io.IOException;

public class login implements HttpHandler {
    public login(){}
    public void handle(HttpExchange request) {
        try {
            if (request.getRequestMethod().equals("POST")) {
                handlePost(request);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public void handlePost(HttpExchange request) throws IOException, JSONException {
        System.out.println("POST triggered");
        int statusCode = 200;
        String body = Utils.convert(request.getRequestBody());
        System.out.println(body);
        JSONObject deserialized = new JSONObject(body);
        String username = deserialized.getString("username");
        String password = deserialized.getString("password");
        Logger logger = LogManager.getLogger(App.class);
        System.out.println(username);
        logger.error(username + " tried to log in");
        request.sendResponseHeaders(statusCode, -1);
    }
}
